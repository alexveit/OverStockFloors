<html>
	<head>
		<script>
			
			var mymeasurements = new Array();
						
			function Measurement(input)
			{
				if (typeof(input)==='string')
				{
					var n;
					if(input.indexOf("x") !== -1)
						n = input.split("x");
					else if(input.indexOf(".") !== -1)
						n = input.split(".");
					else if(input.indexOf("/") !== -1)
						n = input.split("/");
					else if(input.indexOf("+") !== -1)
						n = input.split("+");
					else if(input.indexOf(":") !== -1)
						n = input.split(":");

					this.width = parseInt(n[0], 10);
					this.length = parseInt(n[1], 10);
				}
				else
				{
					this.width = input.width;
					this.length = input.length;
				}
			}
			
			Measurement.prototype.add_width = function(width) { this.width += width; }
			
			Measurement.prototype.toString = function() { return this.width.toString() + "x" + this.length.toString(); }
						
			function isWhitespaceNotEmpty(text) { return text.length > 0 && !/[^\s]/.test(text); }
			
			var standard;
			var needs;
			
			function add_table()
			{
				var size = 0;
				if(standard.length > needs.length)
					size = standard.length;
				else
					size = needs.length;
				
				var html = "<table border=\"1\" style=\"width:210px;\"><tbody><tr>";
				html = html.concat("<td style=\"width:50%; text-align:center;\">Standard</td>");
				html = html.concat("<td style=\"width:50%; text-align:center;\">Needs</td></tr>");
				
				var td = "<td style=\"text-align:center;\">";
				
				for(var i = 0; i < size; i++)
				{
					html = html.concat("<tr>");
					
					if(i < standard.length)
						html = html.concat(td + standard[i].toString() + "</td>");
					else
						html = html.concat("<td>&nbsp;</td>");
					
					if(i < needs.length)
						html = html.concat(td + needs[i].toString() + "</td>");
					else
						html = html.concat("<td>&nbsp;</td>");
						
					html = html.concat("</tr>");
				}
				
				html = html.concat("</tbody></table>");
				
				document.getElementById("addtable").innerHTML = html;
			}
			
			function split_standard_from_needs()
			{
				for (var i = 0; i < mymeasurements.length; i++)
				{
					var temp_w = mymeasurements[i].width;
					
					if(temp_w < 12)
					{
						needs.push(new Measurement(mymeasurements[i]));
					}
					else if(temp_w == 12)
					{
						standard.push(new Measurement(mymeasurements[i]));
					}
					else
					{
						var good = false;
						while(!good)
						{
							if(temp_w > 12)
							{
								standard.push(new Measurement("12x" + mymeasurements[i].length.toString()));
								temp_w -= 12;
							}
							else if(temp_w == 12)
							{
								standard.push(new Measurement("12x" + mymeasurements[i].length.toString()));
								good = true;
							}
							else
							{
								needs.push(new Measurement(temp_w.toString() + "x" + mymeasurements[i].length.toString()));
								good = true;
							}
						}
					}
				}
			}
			
			function aggregate_same_lengths()
			{
				for (var i = 0; i < needs.length; i++)
				{
					for (var j = i+1; j < needs.length; j++)
					{
						if(needs[j].length == needs[i].length)
						{
							needs[i].add_width(needs[j].width);
							needs.splice(j, 1);
						}
					}
				}
			}
			
			function consolidate_standards()
			{
				for (var i = 0; i < needs.length; i++)
				{
					if(needs[i].width == 12)
					{
						standard.push(new Measurement(needs[i]));
					}
					else if(needs[i].width > 12)
					{
						var good = false;
						while(!good)
						{
							if(needs[i].width > 12)
							{
								standard.push(new Measurement("12x" + needs[i].length.toString()));
								needs[i].width -= 12;
							}
							else if(needs[i].width == 12)
							{
								standard.push(new Measurement("12x" + needs[i].length.toString()));
								needs.splice(i, 1);
								good = true;
							}
							else
							{
								good = true;
							}
						}
					}
				}
			}
						
			function calculate()
			{
				standard = new Array();
				needs = new Array();
				
				split_standard_from_needs();
				aggregate_same_lengths();
				consolidate_standards();
				add_table();

			}
			
			function add_measurement()
			{
				var val = document.forms["myForm"]["measurement"].value;
				
				if (val==null || val=="" || isWhitespaceNotEmpty(val))
				{
					calculate();
					document.getElementById("measurement").focus()
					return false;
				}
				
				var measure = new Measurement(val);
				
				mymeasurements.push(measure);
				
				var newNode = document.createElement("li");
				var newContent = document.createTextNode(measure.toString());
				var my_ul = document.getElementById("mylist");
				
				newNode.appendChild(newContent);
				
				document.body.insertBefore(newNode, my_ul);
				document.forms["myForm"]["measurement"].value = "";
				
				document.getElementById("measurement").focus();
				
			}
			
			function checkEnter(e)
			{
				e = e || event;
				var txtArea = /textarea/i.test((e.target || e.srcElement).tagName);
				var is_enter = (e.keyCode || e.which || e.charCode || 0) !== 13;
				
				if(!is_enter)
					add_measurement();
					
				return txtArea || is_enter;
			}
			
			function load() { document.getElementById("measurement").focus(); }
			
		</script>
	</head>
	<body onload="load()">
		
		<table>
			<tbody>
				<tr>
					<td style="width:210px;">
						Use x . / + or : to separate measurements<br /><br />
						Valid examples are:<br />
						<table style="width:100%;">
							<tbody>
								<tr>
									<td style="text-align:center;">15x7</td>
									<td style="text-align:left;">17.9</td>
								</tr>
								<tr>
									<td style="text-align:center;">10/8</td>
									<td style="text-align:left;">15+10</td>
								</tr>
								<tr>
									<td style="text-align:center;">13:12</td>
								</tr>
							</tbody>
						</table>
					</td>
				</tr>
			</tbody>
		</table>
		
		<form name="myForm">
			<table>
				<tbody>
					<tr>
						<td><input id="measurement" type="text" size="6" onkeypress="return checkEnter(event)" /></td>
						<td style="text-align:center;"><input type="button" onclick="add_measurement()" value="add measurement"></td>
					</tr>
					<tr>
						<td>&nbsp;</td>
						<td style="text-align:center;"><input type="button" onclick="calculate()" value="calculate"></td>
					</tr>
				</tbody>
			</table>
		</form>
		
		<hr style="width:208px; text-align:left; margin-left:0px">
		<hr style="width:208px; text-align:left; margin-left:0px" id='mylist'>
			
		<div id="addtable"></div>
			
	</body>

</html>