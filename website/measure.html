<!DOCTYPE html>
<html>
	<head>
		<script>
			
			var mymeasurements = new Array();
			
			function Measurement(input)
			{
				if (typeof(input)==='string')
				{
					var n;
					if(input.indexOf("x") !== -1)
						n = input.split("x");
					else if(input.indexOf("/") !== -1)
						n = input.split("/");
					else if(input.indexOf("+") !== -1)
						n = input.split("+");
					else if(input.indexOf(":") !== -1)
						n = input.split(":");

					this.width = parseFloat(n[0], 10);
					this.length = parseFloat(n[1], 10);
				}
				else
				{
					this.width = input.width;
					this.length = input.length;
				}
			}
			
			Measurement.prototype.add_width = function(width) { this.width += width; }
			
			Measurement.prototype.toString = function() { return this.width.toString() + "x" + this.length.toString(); }
			
			function isWhitespaceNotEmpty(text) { return text.length > 0 && !/[^\s]/.test(text); }
			
			var standard;
			var needs;
			
			function add_table()
			{
				var size = 0;
				if(standard.length > needs.length)
					size = standard.length;
				else
					size = needs.length;
				
				var html = "<table border=\"1\" style=\"width:210px;\"><tbody><tr>";
				html = html.concat("<td style=\"width:50%; text-align:center;\">Standard</td>");
				html = html.concat("<td style=\"width:50%; text-align:center;\">Needs</td></tr>");
				
				var td = "<td style=\"text-align:center;\">";
				
				for(var i = 0; i < size; i++)
				{
					html = html.concat("<tr>");
					
					if(i < standard.length)
						html = html.concat(td + standard[i].toString() + "</td>");
					else
						html = html.concat("<td>&nbsp;</td>");
					
					if(i < needs.length)
						html = html.concat(td + needs[i].toString() + "</td>");
					else
						html = html.concat("<td>&nbsp;</td>");
						
					html = html.concat("</tr>");
				}
				
				var len = 0;
				for(var i = 0; i < standard.length; i++)
				{
					len += standard[i].length;
				}
				
				if(len > 0)
				{
					html = html.concat("<tr style=\"background-color:yellow;\"><td style=\"text-align:center;\">12x" + len + "</td></tr>");
					html = html.concat("</tbody></table>");
					document.getElementById("addtable").innerHTML = html;
				}
			}
			
			function split_standard_from_needs()
			{
				for (var i = 0; i < mymeasurements.length; i++)
				{
					var temp_w = mymeasurements[i].width;
					
					if(temp_w < 12.0)
					{
						needs.push(new Measurement(mymeasurements[i]));
					}
					else if(temp_w >= 12.0 && temp_w < 13.0)
					{
						standard.push(new Measurement(mymeasurements[i]));
					}
					else
					{
						var good = false;
						while(!good)
						{
							
							if(temp_w >= 12.0 && temp_w < 13.0)
							{
								standard.push(new Measurement("12x" + mymeasurements[i].length.toString()));
								good = true;
							}
							else if(temp_w > 12.0)
							{
								standard.push(new Measurement("12x" + mymeasurements[i].length.toString()));
								temp_w -= 12;
							}
							else
							{
								needs.push(new Measurement(temp_w.toString() + "x" + mymeasurements[i].length.toString()));
								good = true;
							}
						}
					}
				}
			}
			
			function aggregate_same_lengths()
			{
				for (var i = 0; i < needs.length; i++)
				{
					for (var j = i+1; j < needs.length; j++)
					{
						if(needs[j].length == needs[i].length)
						{
							needs[i].add_width(needs[j].width);
							needs.splice(j, 1);
						}
					}
				}
			}
			
			function consolidate_standards()
			{
				var round = document.getElementById("round").checked;
				for (var i = 0; i < needs.length; i++)
				{
					if(needs[i].width >= 11.0 && needs[i].width < 12.0 && round)
					{
						needs[i].width = 12;
						standard.push(new Measurement(needs[i]));
						needs.splice(i, 1);
					}
					else if(needs[i].width >= 12.0 && needs[i].width < 13.0)
					{
						standard.push(new Measurement(needs[i]));
						needs.splice(i, 1);
					}
					else if(needs[i].width > 12.0)
					{
						var good = false;
						while(!good)
						{
							if(needs[i].width >= 11.0 && needs[i].width < 12.0 && round)
							{
								needs[i].width = 12;
								standard.push(new Measurement(needs[i].width.toString() + "x" + needs[i].length.toString()));
								needs.splice(i, 1);
								good = true;
							}
							else if(needs[i].width >= 12.0 && needs[i].width < 13.0)
							{
								standard.push(new Measurement(needs[i].width.toString() + "x" + needs[i].length.toString()));
								needs.splice(i, 1);
								good = true;
							}
							else if(needs[i].width > 12.0)
							{
								standard.push(new Measurement(needs[i].width.toString() + "x" + needs[i].length.toString()));
								needs[i].width -= 12;
							}
							else
							{
								good = true;
							}
						}
					}
				}
			}
			
			function calc_totals()
			{
				var ordered_needs = new Array()
				
				for(var i = 0; i < needs.length; i++)
				{
					ordered_needs.push(new Measurement(needs[i]));
				}
				
				ordered_needs.sort(function(a,b) { return b.length - a.length; } );
				
				var remaining_w = 12;
								
				var good = false;
				
				var waste = 0;
				
				var acounted_for = new Array();
				
				var grid = new Array(0,0,0,0,0,0,0,0,0,0,0,0);
								
				//needs word not correct yet
				for(var i = 0; i < ordered_needs.length; i++)
				{
					if(ordered_needs[i].width <= remaining_w)
					{
						acounted_for.push(new Measurement(ordered_needs[i]));
						var len = 0;
						for(var j = 12-remaining_w, k = 0; k < ordered_needs[i].width; j++, k++)
						{
							if(k == 0)
							{
								grid[j] += parseInt(ordered_needs[i].length);
								len = grid[j];
							}
							else
							{
								waste = len - grid[j];
								grid[j] = len;
							}
						}
						remaining_w -= ordered_needs[i].width;
						ordered_needs.splice(i, 1);
						i--;
					}
					else
					{
						remaining_w = 12;
						i--;
					}
				}
				
			}
			
			function calculate()
			{
				standard = new Array();
				needs = new Array();
				
				split_standard_from_needs();
				aggregate_same_lengths();
				consolidate_standards();
				add_table();
				
				calc_totals();
				
			}
			
			function add_measurement()
			{
				var val = document.forms["myForm"]["measurement"].value;
				
				if (val==null || val=="" || isWhitespaceNotEmpty(val))
				{
					calculate();
					document.getElementById("measurement").focus()
					return false;
				}
				
				var measure = new Measurement(val);
				
				mymeasurements.push(measure);
				
				var newNode = document.createElement("li");
				var newContent = document.createTextNode(measure.toString());
				var my_ul = document.getElementById("mylist");
				
				newNode.appendChild(newContent);
				
				document.body.insertBefore(newNode, my_ul);
				document.forms["myForm"]["measurement"].value = "";
				
				document.getElementById("measurement").focus();
				
			}
			
			function checkEnter(e)
			{
				e = e || event;
				var txtArea = /textarea/i.test((e.target || e.srcElement).tagName);
				var is_enter = (e.keyCode || e.which || e.charCode || 0) !== 13;
				
				if(!is_enter)
					add_measurement();
					
				return txtArea || is_enter;
			}
			
			function load() { document.getElementById("measurement").focus(); }
			
		</script>
	</head>
	<body onload="load()">
		
		<table>
			<tbody>
				<tr>
					<td style="width:210px;">
						Use x / + or : to separate measurements. The maximum precision is by quarters<br />
						<table style="width:100%;">
							<tbody>
								<tr>
									<td style="text-align:center;">1/4 = 0.25</td>
									<td style="text-align:left;">2/4 = 0.5</td>
								</tr>
								<tr>
									<td style="text-align:center;">1/2 = 0.5</td>
									<td style="text-align:left;">3/4 = 0.75</td>
								</tr>
							</tbody>
						</table>
						Valid input examples are:<br />
						<table style="width:100%;">
							<tbody>
								<tr>
									<td style="text-align:center;">15.75x7.5</td>
									<td style="text-align:left;">15+10</td>
								</tr>
								<tr>
									<td style="text-align:center;">10/8.25</td>
									<td style="text-align:left;">13.5:12</td>
								</tr>
							</tbody>
						</table>
					</td>
				</tr>
			</tbody>
		</table>
		
		<form name="myForm">
			<table>
				<tbody>
					<tr>
						<td colspan="2"><input type="checkbox" id="round" value="Bike">Round 11' to 12' when calculating</td>
					</tr>
					<tr>
						<td><input id="measurement" type="text" size="6" onkeypress="return checkEnter(event)" /></td>
						<td style="text-align:center;"><input type="button" onclick="add_measurement()" value="add measurement"></td>
					</tr>
					<tr>
						<td>&nbsp;</td>
						<td style="text-align:center;"><input type="button" onclick="calculate()" value="calculate"></td>
					</tr>
				</tbody>
			</table>
		</form>
		
		<hr style="width:208px; text-align:left; margin-left:0px">
		<hr style="width:208px; text-align:left; margin-left:0px" id='mylist'>
			
		<div id="addtable"></div>
			
	</body>

</html>